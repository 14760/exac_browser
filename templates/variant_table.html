{% block variant_table %}
{% include 'variant_selectors.html' %}
<script>
    $(document).ready(function() {
        window.table_variants = {{ table_variants|tojson|safe }};

        $("#variants_loading").hide();
        $("#variants_table_container").show();
        $("#variant_table").tablesorter({
            widthFixed: true,
            sortList: [[1,0], [2,0], [7,1]],
            headers: {
                8: { sorter: false, parser: false }
            }
        });
{#                .tablesorterPager({container: $("#pager"), positionFixed: false});#}
{#        if (window.table_variants.length <= 10) {#}
            $('#pager').hide();
{#        }#}
        $(document).ready(function() {
            $('[frequency="0.0"]').hide();
            var data = window.table_variants;

            var width = 50;
            var height = 15;

            var bounds = get_af_bounds(data);
            var min_af = bounds[0];
            var max_af = bounds[1];
            var x_scale = d3.scale.linear()
                .domain([0, 7])
                .range([0, width]);

            var svg;
            $.each(data, function(i, d) {
                svg = d3.select('#variant_af_box_' + d.variant_id)
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g");

                svg.append('rect')
                    .style('fill', 'steelblue')
                    .attr('x', 0)
                    .attr('y', 0)
                    .attr('width', function() {
                        if (!d.allele_freq) {
                            return x_scale(0);
                        } else if (d.allele_count == 1) {
                            return x_scale(1);
                        } else if (d.allele_freq < 1/10000) {
                            return x_scale(2);
                        } else if (d.allele_freq < 1/1000) {
                            return x_scale(3);
                        } else if (d.allele_freq < 1/100) {
                            return x_scale(4);
                        } else if (d.allele_freq < 1/20) {
                            return x_scale(5);
                        } else if (d.allele_freq < 1/2) {
                            return x_scale(6);
                        } else {
                            return x_scale(7);
                        }
                    })
                    .attr('height', height);
            });
        });
    });
</script>
<div id="variants_loading">Loading variants...</div>
<div id="variants_table_container" style="display: none;">
    <table id="variant_table" class="tablesorter">
        <thead>
            <tr>
                <th>Variant</th>
                <th>Chromosome</th>
                <th>Position</th>
                <th>Filter</th>
                <th>Annotation</th>
                <th>Allele Count</th>
                <th>Allele Number</th>
                <th>Allele Frequency</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        {% for variant in table_variants %}
            <tr class="table_variant" id="variant_{{ variant.variant_id }}"
                category="{{ variant.category }}" filter_status="{{ variant.filter }}" frequency="{{ variant.allele_freq }}">
                <td>
                    <a href="/variant/{{ variant.chrom }}-{{ variant.pos }}-{{ variant.ref }}-{{ variant.alt }}">
                    {% if variant.rsid == '.' %}
                        {{ variant.chrom }}:{{ variant.pos }}
                    {% else %}
                        {{ variant.rsid }}
                    {% endif %}
                        {% if variant.ref|length > 20 %}
                            {{ variant.ref[1:20] }}...
                        {% else %}
                            {{ variant.ref }}
                        {% endif %} /
                        {% if variant.alt|length > 20 %}
                            {{ variant.alt[1:20] }}...
                        {% else %}
                            {{ variant.alt }}
                        {% endif %}

                    </a>
                </td>
                <td> {{ variant.chrom }}</td>
                <td> {{ variant.pos }}</td>
                <td> {{ variant.filter }} </td>
                <td class="{{ variant.category }}"><b> {{ variant.major_consequence|replace('_variant', '')|replace('_', ' ')|capitalize|replace('utr', 'UTR') }} </b> </td>
                <td> {{ variant.allele_count }} </td>
                <td> {{ variant.allele_num }} </td>
                <td>
                    {% if variant.allele_freq %}
                        {{ '%0.4g' % variant.allele_freq }}
                    {% else %}
                        {{ variant.allele_freq }}
                    {% endif %}
                </td>
                <td id="variant_af_box_{{ variant.variant_id }}"></td>
            </tr>
        {% endfor %}
        <tbody>
    </table>
    <div id="pager" class="pager">
        <form>
            <i class="fa fa-caret-square-o-left fa-2x first link"></i>
            <i class="fa fa-caret-left fa-2x prev link"></i>
            <input type="text" class="pagedisplay" style="display: none;"/>
            <i class="fa fa-caret-right fa-2x next link"></i>
            <i class="fa fa-caret-square-o-right fa-2x last link"></i>
            <select class="pagesize">
                <option selected="selected" value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100000">All</option>
            </select>
        </form>
    </div>
</div>
{% endblock %}